{% extends "base/admin_base.html" %}

{% block title %}Categories - Career DNA Admin{% endblock %}

{% block content %}
<div class="category-management">
    <div class="page-header">
        <h2>Question Categories</h2>
        <button class="btn btn-primary" onclick="showCreateCategoryModal()">Add Category</button>
    </div>

    <div class="categories-list">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Color</th>
                    <th>Status</th>
                    <th>Questions</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for category in categories %}
                <tr>
                    <td class="category-name">{{ category.name }}</td>
                    <td class="category-description">{{ category.description or "No description" }}</td>
                    <td>
                        <div class="color-preview" style="background-color: {{ category.color }};"></div>
                        {{ category.color }}
                    </td>
                    <td>
                        <span class="status {{ 'active' if category.is_active else 'inactive' }}">
                            {{ "Active" if category.is_active else "Inactive" }}
                        </span>
                    </td>
                    <td class="question-count">{{ category.questions|length }}</td>
                    <td class="actions">
                        <button class="btn btn-sm btn-secondary" onclick="editCategory({{ category.id }}, '{{ category.name }}', '{{ category.description or '' }}', '{{ category.color }}', {{ category.is_active|lower }})">Edit</button>
                        <form method="post" action="/admin/categories/{{ category.id }}/delete" style="display: inline;" 
                              onsubmit="return confirm('Are you sure? Questions in this category will become uncategorized.')">
                            <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                        </form>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" class="text-center">No categories created yet</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Create Category Modal -->
<div id="createCategoryModal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Create New Category</h3>
            <button class="close" onclick="hideCreateCategoryModal()">&times;</button>
        </div>
        <form method="post" action="/admin/categories">
            <div class="modal-body">
                <div class="form-group">
                    <label for="name">Category Name</label>
                    <input type="text" id="name" name="name" required placeholder="e.g., Personality Assessment">
                </div>
                
                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea id="description" name="description" rows="3" 
                              placeholder="Brief description of this category"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="color">Color</label>
                    <input type="color" id="color" name="color" value="#3498db">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="hideCreateCategoryModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Create Category</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Category Modal -->
<div id="editCategoryModal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Edit Category</h3>
            <button class="close" onclick="hideEditCategoryModal()">&times;</button>
        </div>
        <form id="editCategoryForm" method="post">
            <div class="modal-body">
                <div class="form-group">
                    <label for="edit_name">Category Name</label>
                    <input type="text" id="edit_name" name="name" required>
                </div>
                
                <div class="form-group">
                    <label for="edit_description">Description</label>
                    <textarea id="edit_description" name="description" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="edit_color">Color</label>
                    <input type="color" id="edit_color" name="color">
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="edit_is_active" name="is_active">
                        Active
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="hideEditCategoryModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Update Category</button>
            </div>
        </form>
    </div>
</div>

<script>
function showCreateCategoryModal() {
    document.getElementById('createCategoryModal').style.display = 'block';
}

function hideCreateCategoryModal() {
    document.getElementById('createCategoryModal').style.display = 'none';
}

function editCategory(id, name, description, color, isActive) {
    document.getElementById('edit_name').value = name;
    document.getElementById('edit_description').value = description;
    document.getElementById('edit_color').value = color;
    document.getElementById('edit_is_active').checked = isActive;
    
    document.getElementById('editCategoryForm').action = `/admin/categories/${id}/edit`;
    document.getElementById('editCategoryModal').style.display = 'block';
}

function hideEditCategoryModal() {
    document.getElementById('editCategoryModal').style.display = 'none';
}
</script>

<style>
.category-management {
    max-width: 1000px;
    margin: 0 auto;
}

.color-preview {
    display: inline-block;
    width: 20px;
    height: 20px;
    border-radius: 3px;
    margin-right: 8px;
    vertical-align: middle;
    border: 1px solid #ddd;
}

.category-name {
    font-weight: 600;
}

.category-description {
    color: #666;
    max-width: 200px;
}

.question-count {
    text-align: center;
    font-weight: bold;
}
</style>
{% endblock %}